# Проектная работа "Веб-ларек"

Интернет-магазин с товарами для веб-разработчиков.\
В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Стек: `HTML, SCSS, TS`\
Для сборки используется `Webpack`

Структура проекта:

- `src/` — исходные файлы проекта
- `src/components/` — папка с компонентами
- `src/components/base/` — папка с базовым кодом

Важные файлы:

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

Проект представляет собой одностраничное приложение (SPA - Single Page Application) интернет-магазина для веб-разработчиков.\
Архитектура приложения построена на паттерне MVP (Model-View-Presenter), в связи с чем код разделён на 3 слоя:

- `Слой Модели` - код для работы с данными, бизнес-логикой и состоянием приложения
- `Слой Отображения` - код для вывода данных в интерфейс пользователя (в данном случае на веб-страницу, т.е. в DOM), а также за обработку пользовательских взаимодействий
- `Слой Презентера` - соединительный код между слоями Модели и Отображения, отвечающий за обработку событий

Выбор паттерна MVP обусловлен тем, что данные из модели могут иметь несколько отображений в рамках одной страницы (на самой странице и в модальных окнах), а значит для написания соединительного кода будет проще придерживаться концепции, при которой приложению известно и о данных, и об отображении одновременно.

## Описание данных

### Товар

Структура товара в каталоге

```
interface IProductItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

### Список товаров

Структура списка товаров, возвращаемого API

```
interface IProductList {
  total: number;
  items: IProductItem[];
}
```

### Данные покупателя

Структура данных, формируемая для оформления заказа

```
interface IOrderData {
  payment: PaymentMethod;
  address: string;
  email: string;
  phone: string;
}

type PaymentMethod = "card" | "cash";
```

## Базовый код

### Класс Api

Необходим для получения данных от сервера и содержит в себе основную логику для работы с http-запросами.\
Конструктар класса принимает в себя базовый url-адрес сервера, а также (опционально) объект заголовков запроса.

Методы:

- `get` - принимает в себя endpoint, по которому выполняется GET-запрос, и возвращает promise с объектом данных ответа
- `post` - принимает в себя endpoint, объект отправляемых на сервер данных и (опционально) `ApiPostMethod` метод запроса (по умолчанию - `POST`), выполняет запрос в соответствиии с указанным методом и возвращает promise с объектом данных ответа

### AppApi

Расширяет базовое Api и предоставляет удобные методы для взаимодействия с сервером:

- `getProductList(): Promise<IProductList>` - получает список товаров с сервера
- `getProductItem(id: string): Promise<IProductItem>` - получает конкретный товар с сервера по id
- `postOrder(data: IOrderRequest): Promise<IOrderResponse>` - отправляет данные заказа на сервер

### Класс EventEmitter

Классическая реализация брокера событий (паттерн Observer), благодаря которому возможно строить приложение с применением СОП.\
Применяется в слоях Модели и Отображения для генерации событий, а также в слое Презентера для их обработки.

Методы:

- `on` - устанавливает обработчик на событие, принимая в себя название события и callback обработчика
- `off` - снимает обработчик с события, принимая в себя название события и callback обработчика
- `emit` - инициирует событие с данными, принимая в себя название события и (опционально) данные
- `trigger` - создаёт callback-триггер, генерирующий событие при вызове, принимая в себя название события и (опционально) контекст

## Слой Модели (Model)

### ProductsModel

Модель данных для работы с товарами.

Поля:

- `_products: IProductItem[]` - массив всех товаров
- `events: IEvents` - брокер событий

Методы:

- `get products(): IProductItem[]` - геттер для доступа к списку всех товаров
- `set products(products: IProductItem[])` - сеттер для установки списка товаров целиком (например, для сохранения списка, который вернёт Api)
- `getProduct(id: string): IProductItem` - возвращает конкретный товар по id

### BasketModel

Модель данных для работы с корзиной.

Поля:

- `_products: IProductItem[]` - массив всех товаров в корзине
- `events: IEvents` - брокер событий

Методы:

- `get products(): IProductItem[]` - геттер для получения всего списка товаров в корзине
- `addProduct(product: IProductItem): void` - добавляет товар в корзину
- `removeProduct(id: string): void` - удаляет товар из корзины
- `clearBasket(): void` - очищает корзину
- `getTotal(): number` - расчитывает сумму стоимостей всех товаров, которые находятся в корзине
- `isInBasket(id: string): boolean` - проверяет наличие товара с указанным id в корзине
- `getOrderItemsIDs(): string[]` - предоставляет массив id не бесценных товаров для формирования заказа

### OrderModel

Модель данных для работы с заказом.

Поля:

- `_order: IOrderData` - данные о заказе (способ оплаты, адрес, электронная почта и номер телефона)
- `events: IEvents` - брокер событий

Методы:

- `get order(): IOrderData` - возвращает данные о заказе
- `setPayment(data: Pick<IOrderData, 'payment' | 'address'>): void` - установаливает данные о способе оплаты и адресе (форма 1)
- `setContacts(data: Pick<IOrderData, 'email' | 'phone'>): void` - устанавливает данные о почте и телефоне (форма 2)

## Слой Отображения (View)

### Page

Класс отображения, отвечающий за главную страницу.

Поля:

- `page: HTMLElement` - главная страница
- `gallery: HTMLElement` - список для карточек товаров
- `basket: HTMLButtonElement` - иконка корзины
- `basketCounter: HTMLElement` - счётчик товаров в корзине
- `bodyScrollY: number` - позиция прокрутки страницы
- `events: IEvents` - брокер событий

Методы:

- `renderGallery(cards: HTMLElement[]): void` - отрисовка списка карточек
- `renderBasket(counter: number): void` - отрисовка значения счётчика в корзине
- `lock(value: boolean): void` - управление блокировкой страницы (запрет/разрешение скролла)

### Modal

Класс отображения, отвечающий за модальные окна.

Поля:

- `container: HTMLElement` - элемент обёртки модального окна
- `modal: HTMLElement` - элемент модального окна
- `_content: HTMLElement` - содержимое модального окна
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `events: IEvents` - брокер событий

Методы:

- `set content(content: HTMLElement)` - сеттер для содержимого, который установаливает в модальном окне переданную разметку
- `open(): void` - открывает модальное окно
- `close(): void` - закрывает модальное окно

### Card

Родительский абстрактный класс отображения, отвечающий за карточку товара.\
Предоставляет минимальный набор свойств и метод `render`, которые есть у любого отображения товара.\
Конструктор принимает template разметки необходимого отображения и данные товара.

Поля:

- `card` - элемент карточки, получаемый из template
- `title: HTMLElement` - элемент для отображения названия товара
- `price: HTMLElement` - элемент для отображения цены на товар

Методы:

- `render(): HTMLElement` - возвращает заполненную данными разметку для отрисовки

### GalleryItem

Расширяет абстрактный класс `Card`, добавляя ему свойства, необходимые для отображения карточки товара в галерее на главной странице:

- `category: HTMLElement` - элемент для отображения категории товара
- `image: HTMLImageElement` - элемент для отображения картинки товара
- `events: IEvents` - брокер событий

### CardPreview

Расширяет класс `GalleryItem`, добавляя ему свойства, необходимые для отображения карточки товара в модальном окне:

- `description: HTMLElement` - элемент для отображения описания товара
- `basketButton: HTMLButtonElement` - элемент для отображения кнопки добавления товара в корзину
- `events: IEvents` - брокер событий

### BasketItem

Расширяет абстрактный класс `Card`, добавляя ему свойства, необходимые для отображения карточки товара в корзине:

- `index: HTMLElement` - элемент для отображения номера товара в корзине
- `removeButton: HTMLElement` - элемент для отображения кнопки удаления товара из корзины
- `events: IEvents` - брокер событий

### Basket

Класс отображения, отвечающий за корзину.\
Конструктор принимает template разметки страницы и массив карточек `BasketItem`

Поля:

- `basket: HTMLElement` - элемент корзины, получаемый из template
- `_products: HTMLElement[]` - список всех карточек товаров, которые находятся в корзине
- `productsList: HTMLElement` - элемент списка товаров в корзине
- `totalPrice: HTMLElement` - элемент для отображения итоговой суммы товаров в корзине
- `orderButton: HTMLButtonElement` - элемент кнопки оформления заказа
- `events: IEvents` - брокер событий

Методы:

- `set products(products: HTMLElement[])` - сеттер, устанавливающий список карточек товара
- `setTotalPrice(total: number): void` - устанавливает итоговую сумму товаров
- `render(): HTMLElement` - возвращает заполненную данными разметку для отрисовки

### Form

Родительский абстрактный класс отображения, отвечающий за форму.\
Предоставляет минимальный набор свойств и метод `render`, которые есть у любого отображения формы.\
Конструктор принимает template разметки необходимого отображения.

Поля:

- `form: HTMLFormElement` - элемент формы, получаемый из template
- `submitButton: HTMLButtonElement` - элемент кнопки отправки формы
- `formErrors: HTMLElement` - элемент для отображения ошибок в форме

Методы:

- `clearForm(): void` - очищает поля и ошибки формы
- `render(): HTMLFormElement` - возвращает разметку для отрисовки

### PaymentForm

Расширяет абстрактный класс `Form`, добавляя ему свойства, необходимые для отображения формы получения способа оплаты и адреса:

- `cardButton: HTMLButtonElement` - элемент кнопки для выбора способа оплаты "Онлайн"
- `cashButton: HTMLButtonElement` - элемент кнопки для выбора способа оплаты "При получении"
- `addressInput: HTMLInputElement` - элемент для поля ввода адреса
- `private currentPaymentMethod: PaymentMethod | undefined` - выбранный способ оплаты
- `events: IEvents` - брокер событий

Методы:

- `checkValidation(): void` - проверка валидности формы

### ContactsForm

Расширяет абстрактный класс `Form`, добавляя ему свойства, необходимые для отображения формы получения адреса электронной почты и номера телефона:

- `emailInput: HTMLInputElement` - элемент для поля ввода адреса электронной почты
- `phoneInput: HTMLInputElement` - элемент для поля ввода номера телефона
- `events: IEvents` - брокер событий

Методы:

- `checkValidation(): void` - проверка валидности формы

### Success

Класс отображения, отвечающий за окно успешной покупки.

Поля:

- `success: HTMLElement` - элемент разметки окна
- `description: HTMLElement` - элемент для отображения сообщения
- `closeButton: HTMLButtonElement` - элемент для кнопки "За новыми покупками!"
- `events: IEvents` - брокер событий

Методы:

- `setDescription(totalPrice: number): void` - устанавливает количество списанных синапсов в описании в окне
- `render(): HTMLElement` - возвращает заполненную данными разметку для отрисовки

## Слой Презентера (Presenter)

Т.к. приложение небольшое и одностраничное, весь соединительный код не выделен в отдельные классы и находится в `index.ts`

### Взаимодействие компонентов и слоёв приложения

Взаимодействие между компонентами построено с использованием СОП (Событийно-Ориентированного Подхода), реализуемого при помощи базового класса `EventEmitter`, что позволит обеспечить предсказуемое поведение компонентов, облегчит тестирование и даст возможности для масштабирования.

#### Пример взаимодействия

1. Отображение `BasketItem` реагирует на нажатие кнопки удаления товара и генерирует событие `basket-item:removed`
2. Презентер обрабатывает событие и вызывает метод `removeProduct` модели `BasketModel` для изменения данных
3. Модель `BasketModel` изменяет данные и генерирует событие `basket:changed`
4. Презентер обрабатывает событие и вызывает сеттер поля `products` отображения `Basket`, передавая в него данные из модели, а затем вызывает `render` для получения обновлённой разметки
5. Отображение `Basket` перерисовывается отображая обновленные данные

### События, генерируемые в приложении

_События изменения данных (генерируются классами моделями данных)_

- `products:changed` - изменение списка товаров в `ProductsModel`
- `basket:changed` - изменения списка товаров в корзине в `BasketModel`
- `order:changed` - изменение данных заказа в `OrderModel`

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `modal:opened` - открытие модального окна `Modal`
- `modal:closed` - закрытие модального окна `Modal`
- `modal:close-request` - запрос на закрытие модального окна из компонентов представления
- `card-preview:opened` - выбор карточки `GalleryItem`, открытие карточки товара `CardPreview` в модальном окне
- `basket:opened` - открытие корзины `Basket` в модальном окне
- `product:added` - добавление товара в корзину по кнопке в `CardPreview`
- `product:removed` - удаление товара из корзины по кнопке в `CardPreview` или `BasketItem`
- `order:opened` - переход к форме оформления заказа по кнопке в `Basket`, открытие формы `PaymentForm` в модальном окне
- `order:payment-updated` - отправка формы `PaymentForm`, открытие формы `ContactsForm` в модальном окне
- `order:contacts-updated` - отправка формы `ContactsForm`, открытие окна `Success` в модальном окне
